# poc for finctional reactive program evaluation

The "program" is a graph where a node is executed when there was any change on the input.
Input change can be anything. Just to name a few: frame id (run in every frame), location change of a character, keyboard down, path finding route change, collision of objects, etc. 

In the POC:
- all node has 2 f64 input and 1 f64 output.
- the "native" nodes perform one of +,-,*,min,max,avg operation
- the wasm is a brute fore, all node store the whole wasm instance with its store, etc. The script is the same: (a+b)+1, jsut a quik check for wasm interop "cost"
- edges and nodes are generated by random (output is not important now) but the graph is a DAG in all case
- the system has a single f64 input and the whole graphs is effected by it's change (no short-circuit for the stress test)
- all is single threaded, no optimization in memory layet, all nodes are placed in the heap at "random" location without caring for cache.

To extend for graph with cycle handling:
 - some behaviour/edge/node could be added that breaks the cycle and send the event only in the next frame/iteration.

For a sample graph check the <https://github.com/gzp-crey/test_frp_concept/blob/master/small.png> in the repo

Runing:
- test: `cargo test`
- benchmark: `cargo bench --test frp_stress -- --nocapture`

to check the dot: 
- <https://graphviz.org/download/>
- save the output into some file
- `dot -Tps filename.dot -o outfile.ps -v`
- waaaaaait 1-2hour, maybe day depending on the size :)


Some results (on my office computer whatever it is)
- 10/2 nodes
```
node: 10
script node: 2
input edge count: 6
edge count: 14
test bench_run ... bench:         796 ns/iter (+/- 341)
```
- 100/9 nodes
```
node: 100
script node: 9
input edge count: 45
edge count: 155
test bench_run ... bench:       5,857 ns/iter (+/- 2,055)
```
- 1000/102 nodes
```
node: 1000
script node: 102
input edge count: 374
edge count: 1626
test bench_run ... bench:      88,335 ns/iter (+/- 58,944)
```
- 1000/689 nodes
```
node: 1000
script node: 689
input edge count: 404
edge count: 1596
test bench_run ... bench:     278,798 ns/iter (+/- 39,874)
```
- 10000/966 nodes
```
node: 10000
script node: 966
input edge count: 373
edge count: 19627
test bench_run ... bench:   1,396,535 ns/iter (+/- 575,711)
```
- 10000/7066 nodes
```
node: 10000
script node: 7066
input edge count: 401
edge count: 19599
test bench_run ... bench:   6,456,465 ns/iter (+/- 1,749,424)
```
- 100000/9867 nodes
```
node: 100000
script node: 9867
input edge count: 3963
edge count: 196037
test bench_run ... bench:  32,872,370 ns/iter (+/- 13,471,371)
```
- 100000/70109 nodes
```
node: 100000
script node: 70109
input edge count: 4059
edge count: 195941
test bench_run ... bench:  77,265,230 ns/iter (+/- 26,184,327)
```
